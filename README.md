https://github.com/denizterekhin/weblarek
# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

## Сборка

```
npm run build
```

# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get<T extends object>(uri: string)` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post<T extends object>(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse<T>(response: Response): Promise<T>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## «Данные»
Данные, используемые в проекте, представлены интерфейсами IProduct и IBuyer. 

#### Интерфейс IProduct 
Представляет товар, содержит все данные, необходимые для описания товара. 

###### Свойства: 

- **id**: `string` уникальный идентификатор товара
- **title**: `string` - наименование товара
- **image**: `string`- иконка товара
- **price**: `number | null` -  цена товара
- **category**: `string` - группа товара 
- **description**: `string` - описание товара

#### Интерфейс IBuyer
Описывает данные покупателя.

###### Свойства:

- **payment**: `card` | `cash` | `null` -  метод оплаты заказа.
- **address**: `string`  - адрес доставки.
- **email**: `string`  -  электронная почта пользователя.
- **phone**: `string`  -  номер телефона пользователя.

## «<Базовые классы>»
Классы, отвечающие только за хранение данных

### Класс Buyer
Данные покупателя, которые тот должен указать при оформлении заказа.

Поля:

- **payment:** `TPayment` -  метод оплаты заказа
- **email:** `string` -  электронная почта пользователя
- **phone:** `string` -  номер телефона пользователя
- **address:** `string` - адрес доставки
- **events:** `IEvents` - собития

###### Содержит методы:

- **setPayment(payment: TPayment): void** - сохранение типа платежа
- **setEmail(email: string): void** - сохранение почты
- **setPhone(phone: string): void** - сохранение телефона
- **setAddress(address: string): void** - сохранение адреса доставки
- **getAllData(): IBuyer** - получение всех данных покупателя
- **clearData(): void** - очистка данных покупателя
- **validateData()** - валидация данных покупателя на предмет наличия всех указанных данных
- **validatePayment()** - валидация платежа
- **validateAddress()** - валидация адреса доставки
- **validateEmail()** - валидация почты
- **validatePhone()** - валидация телефона

### Класс Products
Хранение товаров, которые можно купить в приложении.

Поля:

- **items:** `IProduct[]` -  массив всех товаров
- **selectedItem:** `IProduct | null` -  товар, выбранный для подробного отображения
- **events:** `IEvents` -  события

###### Содержит методы:

- **setItems(items: IProduct[]): void** - метод для сохранения массива товаров
- **getItems(): IProduct[]** - метод для получения массива товаров
- **getItemById(id: string): IProduct | undefined** - метод для получения одного товара по его id
- **setSelectedItem(item: IProduct): void** - метод для сохранения товара для подробного отображения
- **getSelectedItem(): IProduct | null** - метод для получения товара для подробного отображения

### Класс ShoppingCart
Хранение товаров, которые пользователь выбрал для покупки.

Поля:

- **products:** `IProduct[]` - хранит массив товаров, выбранных покупателем для покупки
- **events:** `IEvents` - события

###### Содержит методы:

- **getProducts(): IProduct[]** - получение массива товаров, которые находятся в корзине
- **addProduct(product: IProduct): void** - метод для добавления товара в корзину
- **removeProduct(product: IProduct): void** - метод для удаления товара из корзины
- **clearCart(): void** - метод полной очистки корзины
- **getTotalCost(): number** - метод для получения стоимости всех товаров в корзине
- **getItemCount(): number** - метод для получения количества товаров в корзине
- **hasProduct(id: string): boolean** - метод для проверки наличия товара в корзине по его id

## «Слой коммуникации»

#### Интерфейс ApiListResponse
Этот интерфейс описывает, какие данные получим при get запросе

###### Свойства:

- **total:** `number` -  количество полученных товаров
- **items:** `Type[]`  - товар

#### Интерфейс IApiListOrder
Этот интерфейс описывает, какие данные хранятся в ответе сервера после оформления заказа. А именно: идентификатор заказа, сумма заказа, сообщение об ошибке.

###### Свойства:

- **id?:** `string` -  идентификатор заказа приходит в виде строки
- **total?:** `string` -  сумма заказа приходит в виде числа
- **error?:** `string` -  сообщение об ошибке записывается в виде строки

### Класс ProductsAPI
Отвечает за получение данных с сервера и отправку данных на сервер

Поля:

- **private api:** `IApi` - принимает в конструктор объект, соответствующий интерфейсу IApi

###### Содержит методы:
- **getProducts()** - делает get запрос на эндпоинт /product/ и возвращает массив товаров
- **placeOrder(order: IBuyer, items: IProduct[], cost: number)** - делает post запрос на эндпоинт /order/ и передаёт в него данные, полученные в параметрах метода

## «Отображение»

#### Интерфейс IHeader
Этот интерфейс описывает тип данных в счётчике товаров корзины в классе Header

###### Свойства:
- **counter:** `number` -  тип данных в счётчике товаров корзины number

#### Класс Header
Наследуется от класса Component - class Header extends Component<IHeader> Отвечает за отображение счетчика товаров в корзине и за кнопку, открывающую корзину.

Поля:

- **counterElement:** `HTMLElement` - счетчик товаров
- **basketButton:** `HTMLButtonElement` - кнопка

###### Содержит методы:
- **set counter(value: number)** - изменяет отображение количества товаров в корзине

#### Интерфейс GallereyData
Этот интерфейс описывает тип тип элемента, куда будет записываться список товаров в классе GallereyData

###### Свойства:
- **catalog:** `HTMLElement[]` -  тип элемента, куда будет записываться список товаров

#### Класс Gallery
Наследуется от класса Component - class Gallery extends Component<GallereyData> Отвечает за отображение списка карточек товаров.

Поля:

- **catalogElement:** `HTMLElement` - обёртка списка карточек

###### Содержит методы:
- **set catalog(items:HTMLElement[])** - задает карточки товаров, которые будут отображаться.

#### Интерфейс IModalContent
Этот интерфейс описывает тип тип элемента, куда будет записываться список товаров в классе GallereyData

###### Свойства:
- **content:** `HTMLElement` -  тип элемента, куда будет записываться список товаров

#### Класс ModalWindow
Наследуется от класса Component - class ModalWindow <IModalContent> extends Component<IModalContent> Отвечает за отображение модальных окон.

Поля:

- **events:** `IEvents` - события
- **modalContent:** `HTMLElement` - обёртка контента модального окна
- **closeButton:** `HTMLButtonElement` - кнопка для закрытия модального окна


###### Содержит методы:
- **open()** - открывает 
- **close()** - закрывает
методы open и close для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.
- **handleEscUp (evt: KeyboardEvent)** - срабатывание по нажатию кнопки "ESC".
- **set content(content: HTMLElement)** - принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса

#### Класс Card
Наследуется от класса Component - class Card<T> extends  Component<T & Pick<IProduct, 'title' | 'price'>> Отвечает за отображение карточки товара. Является родительским для классов, отображающих карточки в разных состояниях.

Поля:

- **priceElement:** `HTMLElement` - стоимость товара
- **titleElement:** `HTMLElement` - название товара

###### Содержит методы:
- **set price(value:number | null)** - задает стоимость товара
- **set title(value:string)** - задает название товара
- **setImage(element: HTMLImageElement, url: string, title: string): void** - задает картинку товара

#### Класс CardCatalog
Наследуется от класса Card - class CardCatalog extends Card<Pick<IProduct, 'image' | 'category'>>

Поля:

- **imageElement:** `HTMLImageElement` - изображение
- **categoryElement:** `HTMLElement` - категория

###### Содержит методы:
- **set category(value: string)** - задает категорию товара
- **set image(value: string)** - задает картинку товара

#### Класс CardPreview
Наследуется от класса Card - class CardPreview extends Card<Pick<IProduct, 'image' | 'category' | 'description'>>

Поля:

- **descriptionElement:** `HTMLElement` - описание товара
- **toBasketButton:** `HTMLButtonElement` - кнопка добавления товара в корзину
- **imageElement** `HTMLImageElement` - изображение
- **categoryElement:** `HTMLElement` - категория

###### Содержит методы:
- **set category(value: string)** - задает категорию товара
- **set image(value: string)** - задает картинку товара
- **set description(value: string)** - задает описание товара
- **set buttonState(state: 'add' | 'remove' | 'disabled')** - задает состояние кнопки: добавить в корзину, удалить из корзины или заблокирована

#### Класс CardBasket
Наследуется от класса Card - class CardBasket extends Card<{ itemIndex: number }>

Поля:

- **indexElement:** `HTMLElement` - интекс товара в корзине
- **buttonRemoveItem:** `HTMLButtonElement` - кнопка удаления товара из корзины

###### Содержит методы:
- **set index( value: number)** - задает описание товара

#### Класс Form
Наследуется от класса Component - class Form<T> extends Component<T & { err: string, buttonState: boolean }> Отвечает за отображение форм. Является родительским для классов, отображающих формы в разных состояниях.

Поля:

- **button:** `HTMLButtonElement` - кнопка подтверждения
- **errorElement:** `HTMLElement` - элемент для вывода ошибок

###### Содержит методы:
- **set buttonState(isValid: boolean)** - задает состояние кнопки
- **set error(err: string)** - выводит ошибку

#### Класс FormOrder
Наследуется от класса Form - class FormOrder extends Form<{ payment: 'cash' | 'card', address: string }>

Поля:

- **paymentButtons:** `HTMLElement[]` - кнопки выбора способа оплаты
- **addressElement:** `HTMLInputElement` - поле ввода адреса
- **paymentElement:** `cash` | `card` | null - выбранный способ оплаты.

###### Содержит методы:
- **set payment(value: 'cash' | 'card')** - задает состояние кнопки
- **set address(value: string)** - задает адрес

#### Класс FormContacts
Наследуется от класса Form - class FormContacts extends Form<{ email: string, phone: string }>

Поля:

- **emailElement:** `HTMLInputElement` - поле ввода почты
- **phoneElement:** `HTMLInputElement` - поле ввода телефона

###### Содержит методы:
- **set email(value: string)** - задает почту
- **set phone(value: string)** - задает телефон

#### Класс Basket
Наследуется от класса Component - class Basket extends Component<{ items: IProduct[];
	total: number; }> Отвечает за отображение корзины.

Поля:

- **listContainer:** `HTMLElement` - элемент, куда будут выводиться добавленные в корзину товары
- **priceContainer:** `HTMLElement` - элемент, куда будет выводиться итоговая сумма
- **orderButton:** `HTMLButtonElement` - кномка оформления заказа

###### Содержит методы:
- **set items(items: HTMLElement[])** - отрисовывает товары в корзине
- **set total(price: number)** - задает итоговую сумму
- **set message(value: string)** - задает уведомление о том, что корзина пуста

## «События приложения»
Все события генерируются через класс EventEmitter и могут содержать дополнительные данные.

### «События каталога товаров»

- **catalog:changed** 

Генерируеться при сохранения массива товаров в классе Products

- **card:select**

Генерируется при клике на карточку товара в каталоге. IProduct - объект выбранного товара. Открывает модальное окно с деталями товара.

### «События карточек товаров»

- **item:to_basked**

Генерируется при нажатии кнопки "В корзину" в модальном окне товара. Добавляет товар в корзину.

- **delet: item_inBasket**

Генерируется при нажатии кнопки удаления товара из корзины. Удаляет товар из корзины.

### «События корзины»

- **basket:open**

Генерируется при нажатии на кнопку корзины в шапке. Открывает модальное окно с содержимым корзины.

- **order**

Генерируется при нажатии кнопки "Оформить заказ" в корзине. Открывает модальное окно оформления заказа.

### «События модальных окон»

- **modal:close**

Генерируется при нажатии кнопки закрытия модального окна. Закрывает модальное окно.

### «События формы заказа»

- **order:payment**

Генерируется при выборе способа оплаты в форме заказа. Данные - { payment: 'cash' | 'card' } - выбранный способ оплаты. Сохраняет выбранный способ оплаты.

- **order:address**

Генерируется при вводе адреса в поле формы заказа. Данные - { address: string } - введенный адрес. Сохраняет адрес доставки.

- **order:next**

Генерируется при нажатии кнопки "Далее" в форме заказа. Не передает данных. Переходит ко второй форме оформления заказа.

### «События формы контактов»

- **contacts:email**

Генерируется при вводе email в поле формы контактов. Данные - { email: string } - введенный email. Сохраняет email покупателя.

- **contacts:phone**

Генерируется при вводе телефона в поле формы контактов. Данные - { phone: string } - введенный номер телефона. Сохраняет номер телефона покупателя.

- **order:submit**

Генерируется при завершении оформления заказа. Не передает данных. Отправляет заказ на сервер и показывает результат.

### «События моделей данных»

- **catalog:changed**

Генерируется при изменении каталога товаров. Данные - { products: IProduct[] } - обновленный список товаров. Уведомляет о изменении каталога.

- **card:select**

Генерируется при выборе товара для просмотра. 

- **basket: changed**

Генерируется при любом изменении содержимого корзины (добавление, удаление, очистка). Данные - { items: IProduct[], total: number, count: number } - содержимое корзины, общая сумма и количество товаров. Уведомляет о изменении корзины.

- **buyer:changed**

Генерируется при изменении любых данных покупателя (способ оплаты, email, телефон, адрес). Данные - { payment: TPayment | null, email: string, phone: string, address: string } - все данные покупателя. Уведомляет о изменении данных покупателя.

## «Презентер»

Презентер является центральным компонентом архитектуры MVP, который содержит основную бизнес-логику приложения и обеспечивает связь между слоями Model и View. В данном проекте презентер реализован в основном скрипте приложения main.ts.







